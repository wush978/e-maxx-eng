<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
</head>
<body>
<!--?title Simpson integration -->
<h1 id="integration-by-simpsons-formula">Integration by Simpson's formula</h1>
<p>We are going to calculate the value of a definite integral</p>
<p><br /><span class="math display">∫<sub><em>a</em></sub><sup><em>b</em></sup><em>f</em>(<em>x</em>)<em>d</em><em>x</em></span><br /></p>
<p>The solution described here was published in one of the dissertations of <strong>Thomas Simpson</strong> in 1743.</p>
<h2 id="simpsons-formula">Simpson's formula</h2>
<p>Let <span class="math inline"><em>n</em></span> be some natural number. We divide the integration segment <span class="math inline">[<em>a</em>; <em>b</em>]</span> into <span class="math inline">2<em>n</em></span> equal parts:</p>
<p><br /><span class="math display"><em>x</em><sub><em>i</em></sub> = <em>a</em> + <em>i</em><em>h</em>,   <em>i</em> = 0…2<em>n</em>,</span><br /> <br /><span class="math display">$$h = \frac {b-a} {2n}.$$</span><br /></p>
<p>Now we calculate the integral separately on each of the segments <span class="math inline">[<em>x</em><sub>2<em>i</em> − 2</sub>, <em>x</em><sub>2<em>i</em></sub>]</span>, <span class="math inline"><em>i</em> = 1…<em>n</em></span>, and then add all the values.</p>
<p>So, suppose we consider the next segment <span class="math inline">[<em>x</em><sub>2<em>i</em> − 2</sub>, <em>x</em><sub>2<em>i</em></sub>],<em>i</em> = 1…<em>n</em></span>. Replace the function <span class="math inline"><em>f</em>(<em>x</em>)</span> on it with a parabola <span class="math inline"><em>P</em>(<em>x</em>)</span> passing through 3 points <span class="math inline">(<em>x</em><sub>2<em>i</em> − 2</sub>, <em>x</em><sub>2<em>i</em> − 1</sub>, <em>x</em><sub>2<em>i</em></sub>)</span>. Such a parabola always exists and is unique; it can be found analytically. For instance we could construct it using the Lagrange polynomial interpolation. The only remaining thing left to do is to integrate this polynomial. If you do this for a general function <span class="math inline"><em>f</em></span>, you receive a remarkable simple expression:</p>
<p><br /><span class="math display">$$\int_{x_ {2i-2}} ^ {x_ {2i}} f (x) ~dx \approx \int_{x_ {2i-2}} ^ {x_ {2i}} P (x) ~dx = \left(f(x_{2i-2}) + 4f(x_{2i-1})+(f(x_{2i})\right)\frac {h} {3} $$</span><br /></p>
<p>Adding these values over all segments, we obtain the final <strong>Simpson's formula</strong>:</p>
<p><br /><span class="math display">$$\int_a ^ b f (x) dx \approx \left(f (x_0) + 4 f (x_1) + 2 f (x_2) + 4f(x_3) + 2 f(x_4) + \ldots + 4 f(x_{2N-1}) + f(x_{2N}) \right)\frac {h} {3} $$</span><br /></p>
<h2 id="error">Error</h2>
<p>The error in approximating an integral by Simpson's formula is</p>
<p><br /><span class="math display">$$ -\tfrac{1}{90} \left(\tfrac{b-a}{2}\right)^5 f^{(4)}(\xi)$$</span><br /></p>
<p>where <span class="math inline"><em>ξ</em></span> is some number between <span class="math inline"><em>a</em></span> and <span class="math inline"><em>b</em></span>.</p>
<p>The error is asymptotically proportional to <span class="math inline">(<em>b</em> − <em>a</em>)<sup>5</sup></span>. However, the above derivations suggest an error proportional to <span class="math inline">(<em>b</em> − <em>a</em>)<sup>4</sup></span>. Simpson's rule gains an extra order because the points at which the integrand is evaluated are distributed symmetrically in the interval <span class="math inline">[<em>a</em>, <em>b</em>]</span>.</p>
<h2 id="implementation">Implementation</h2>
<p>Here <span class="math inline"><em>f</em>(<em>x</em>)</span> is some user function.</p>
<div class="sourceCode"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span class="dt">const</span> <span class="dt">int</span> N = <span class="dv">1000</span> * <span class="dv">1000</span>; <span class="co">// number of steps (already multiplied by 2)</span>

<span class="dt">double</span> simpson_integration(<span class="dt">double</span> a, <span class="dt">double</span> b){
    <span class="dt">double</span> h = (b - a) / N;
    <span class="dt">double</span> s = f(a) + f(b); <span class="co">// a = x_0 and b = x_2n</span>
    <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">1</span>; i &lt;= N - <span class="dv">1</span>; ++i) { <span class="co">// Refer to final Simpson&#39;s formula</span>
        <span class="dt">double</span> x = a + h * i;
        s += f(x) * ((i &amp; <span class="dv">1</span>) ? <span class="dv">4</span> : <span class="dv">2</span>);
    }
    s *= h / <span class="dv">3</span>;
    <span class="kw">return</span> s;
}</code></pre></div>
</body>
</html>
